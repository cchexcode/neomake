version: 0.2

chains:
  publish:
    pre:
      - build
    matrix:
      - workdir: ./code/app/cli
    tasks:
      - script: |
          sed 's/version = "0.0.0"/version = "'{{ version }}'"/g' Cargo.toml > Cargo.toml.tmp
          mv Cargo.toml.tmp Cargo.toml
          cargo publish --allow-dirty

  build:
    matrix:
      - workdir: ./code/app/cli
        env:
          CARGO_ARGS: ""
      - workdir: ./code/app/cli
        env:
          CARGO_ARGS: "--release"
    tasks:
      - script: cargo build $CARGO_ARGS
